# Workflow creating an issue branch. Only runs in the "Create branch" project

name: Issue branch workflow

# Trigger when opening an issue
on:
  issues:
    types: [opened]

jobs:
  create_issue_branch_job:
    runs-on: ubuntu-latest
    steps:
      - name: Check if issue is in "Create branch" project
        id: check_project
        run: |
          ISSUE_NUMBER=${{ github.event.issue.number }}
          PROJECT_NAME="Create branch"
          
          # Fetch the project details via GitHub API
          PROJECTS=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/issues/${ISSUE_NUMBER}}/projects")
          
          # Check if the issue is associated with the "Create branch" project
          if echo "$PROJECTS" | grep -q "\"name\": \"$PROJECT_NAME\""; then
            echo "Issue is in the '$PROJECT_NAME' project"
            echo "run_create_branch=true" >> $GITHUB_ENV
          else
            echo "Issue is not in the '$PROJECT_NAME' project"
            echo "run_create_branch=false" >> $GITHUB_ENV
          fi

      - name: Create Issue Branch
        if: env.run_create_branch == 'true'
        uses: isakskold/create-issue-branch@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
